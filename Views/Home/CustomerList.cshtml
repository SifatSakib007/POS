@model IEnumerable<POS.Models.Customer>

<h2 class="text-2xl font-bold mb-4">Customer List</h2>


<table id="customerTable" class="min-w-full bg-white table-auto">
    <thead>
        <tr class="bg-gray-800 text-white">
            <th class="px-2 py-2 text-left">
                <input id="customerNameFilter" type="text" placeholder="Search by Customer Name" class="border rounded p-2 mr-2" />
            </th>
            <th class="px-2 py-2 text-left">
                <input id="phoneNumberFilter" type="number" placeholder="Search by Phone Number" class="border rounded p-2 mr-2" />
            </th>
            <th class="px-4 py-2 text-left">Address</th>
            <th class="px-4 py-2 text-left">Due</th>
            <th class="px-4 py-2 text-left">Installments</th> <!-- Modified header -->
            <th class="px-4 py-2 text-left">CreatedAt</th>
            <th class="px-4 py-2 text-left">Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var customer in Model)
        {
            <tr class="border-b border-gray-200">
                <td class="px-4 py-2">@customer.Name</td>
                <td class="px-4 py-2">@customer.PhoneNo</td>
                <td class="px-4 py-2">@customer.Address</td>
                <td class="px-4 py-2">@customer.Due</td>

                <!-- Installments Section -->
                <td class="px-4 py-2">
                    @{
                        var paymentAmounts = customer.PaymentAmounts?.Split(',') ?? new string[0];
                        var paymentDates = customer.PaymentDates?.Split(',') ?? new string[0];

                        if (paymentDates.Length > 0)
                        {
                            int startIndex = Math.Max(0, paymentDates.Length - 3);
                            for (int i = startIndex; i < paymentDates.Length; i++)
                            {
                                <p><strong>@(i + 1) installment date:</strong> @paymentDates[i]</p>
                            }
                        }
                        else
                        {
                            <p>No payment history</p>
                        }
                    }
                </td>

                <td class="px-4 py-2">@customer.CreatedAt</td>
                <td class="px-4 py-2">
                    <a asp-action="EditCustomer" asp-route-id="@customer.Id" class="text-blue-500 hover:text-blue-700">
                        <i class="fas fa-edit"></i> <!-- Edit Icon -->
                    </a>
                    |
                    <a asp-action="DeleteCustomer" asp-route-id="@customer.Id" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash-alt"></i> <!-- Delete Icon -->
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>


<!-- Include the required DataTables JS and CSS for filtering functionality -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

<!-- Initialize DataTables -->
<script>
    $(document).ready(function () {
        // Initialize DataTable
        var table = $('#customerTable').DataTable({
            "paging": true,
            "info": false, // Hide pagination info
            "dom": 'lrtip' // Default DataTable layout
        });

        // Custom filter input for Customer Name
        $('#customerNameFilter').on('keyup', function () {
            table.column(0).search(this.value).draw(); // Search in the first column (Customer Name)
        });

        // Custom filter input for Phone Number
        $('#phoneNumberFilter').on('keyup', function () {
            table.column(1).search(this.value).draw(); // Search in the second column (Phone Number)
        });
    });
</script>


