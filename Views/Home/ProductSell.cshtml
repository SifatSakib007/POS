@model POS.Models.Sell
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div class="p-4">
    @* পণ্য বিক্রয় নিবন্ধন  *@
    <p class="text-center text-xl mb-4">পণ্য বিক্রয় নিবন্ধন</p>

    <div class="font-[sans-serif] bg-white">
        <div class="max-w-4xl w-full h-max rounded-md px-4 py-8 mx-auto">
            <form class="mt-8">
                <!-- পণ্য ফর্ম -->
                <div class="flex flex-col md:grid md:grid-cols-2 gap-4">
                    <!-- পূর্বের ফর্ম কোড -->
                    <!-- পণ্যের নাম -->
                    <div>
                        <label asp-for="ProductName" class="block text-sm text-gray-600">পণ্যের নাম</label>
                        <select id="productName" class="px-4 py-3 bg-gray-100 focus:bg-white text-gray-800 w-full text-sm rounded-md focus:outline-blue-600">
                            <option value="">পণ্যের নাম</option>
                            <option value="rice">ধান</option>
                            <option value="wheat">গম</option>
                            <option value="potato">আলু</option>
                            <option value="pointedGourd">পটল</option>
                        </select>
                    </div>

                    <!-- ক্রয় মূল্য -->
                    <div>
                        <label asp-for="BuyPrice" class="block text-sm text-gray-600">ক্রয় মূল্য</label>
                        <input type="number" id="buyPrice" readonly placeholder="সংখ্যায় লিখুন" class="px-4 py-3 bg-gray-100 focus:bg-white text-gray-800 w-full text-sm rounded-md focus:outline-blue-600" />
                    </div>

                    <!-- স্টক -->
                    <div>
                        <label asp-for="Stock" class="block text-sm text-gray-600">স্টক</label>
                        <input type="number" id="stock" readonly value="0" placeholder="সংখ্যায় লিখুন" class="px-4 py-3 bg-gray-100 focus:bg-white text-gray-800 w-full text-sm rounded-md focus:outline-blue-600" />
                    </div>

                    <!-- পরিমাণ -->
                    <div>
                        <label asp-for="Quantity" class="block text-sm text-gray-600">কতটুকু কিনবে পণ্য</label>
                        <input type="number" id="quantity" placeholder="সংখ্যায় লিখুন" class="px-4 py-3 bg-gray-100 focus:bg-white text-gray-800 w-full text-sm rounded-md focus:outline-blue-600" />
                    </div>

                    <!-- বিক্রয় মূল্য -->
                    <div>
                        <label asp-for="SellingPrice" class="block text-sm text-gray-600">বিক্রয় মূল্য</label>
                        <input type="number" id="sellPrice" placeholder="সংখ্যায় লিখুন" class="px-4 py-3 bg-gray-100 focus:bg-white text-gray-800 w-full text-sm rounded-md focus:outline-blue-600" />
                    </div>

                    <!-- মোট মূল্য -->
                    <div>
                        <label asp-for="TotalTotalPrice" class="block text-sm text-gray-600">মোট মূল্য</label>
                        <input type="number" id="totalPrice" readonly placeholder="সংখ্যায় লিখুন" class="px-4 py-3 bg-gray-100 focus:bg-white text-gray-800 w-full text-sm rounded-md focus:outline-blue-600" />
                    </div>
                </div>

                <!-- পণ্য যুক্ত করার বাটন -->
                <button type="button" id="addProductBtn" class="rounded-md px-6 py-3 w-full text-sm tracking-wide bg-blue-600 hover:bg-blue-700 text-white mt-4">যুক্ত করুন</button>

                <!-- পণ্যের টেবিল -->
                <div class="mt-8 overflow-x-auto">
                    <table id="productTable" class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">পণ্যের নাম</th>
                                <th class="px-4 py-2">ক্রয় মূল্য</th>
                                <th class="px-4 py-2">বিক্রয় মূল্য</th>
                                <th class="px-4 py-2">পরিমাণ</th>
                                <th class="px-4 py-2">মোট মূল্য</th>
                                <th class="px-4 py-2">অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- এখানে ডায়নামিকভাবে পণ্য যুক্ত হবে -->
                        </tbody>
                    </table>
                </div>
            </form>
        </div>
    </div>

    @* {/* customer info */} *@
    <form class="font-[sans-serif] max-w-4xl mx-auto">
        <div class="grid sm:grid-cols-2 gap-6">
            <div class="relative flex items-center">
                <input asp-for="TotalTotalPrice" readonly id="totalTotalPrice" type="text" placeholder="মোট টাকা"
                       class="px-2 py-3 bg-white text-black w-full text-sm border-b-2 focus:border-[#007bff] outline-none" />
            </div>
            <div>
                <label asp-for="CustomerName" class="block text-sm text-gray-600">ক্রেতার নাম</label>
                <select id="customerName" class="px-4 py-3 bg-gray-100 fofcus:bg-white text-gray-800 w-full text-sm rounded-md focus:outline-blue-600">
                    <option value="">ক্রেতার নাম</option>
                    <option value="sifat">সিফাত মিয়া</option>
                    <option value="robiul">রবিউল আউয়াল</option>
                    <option value="sabbir">সাব্বির রহমান</option>
                    <option value="shabek">সাবেক মিয়া</option>
                </select>
            </div>


            <div class="relative flex items-center">
                <input asp-for="CustomerPhoneNo" id="customerPhoneNo" type="number" placeholder="ক্রেতার ফোন নাম্বার"
                       class="px-2 py-3 bg-white text-black w-full text-sm border-b-2 focus:border-[#007bff] outline-none" />
            </div>

            <div class="relative flex items-center">
                <input asp-for="CustomerAddress" id="customerAddress" type="text" placeholder="ক্রেতার ঠিকানা"
                       class="px-2 py-3 bg-white text-black w-full text-sm border-b-2 focus:border-[#007bff] outline-none" />
            </div>
            <div class="relative flex items-center sm:col-span-2">
                <input  id="shabek" type="number" readonly placeholder="সাবেক টাকা"
                       class="px-2 py-3 bg-white text-black w-full text-sm border-b-2 focus:border-[#007bff] outline-none" />
            </div>
            <div class="relative flex items-center sm:col-span-2">
                <input id="shorboMotTaka" type="number" placeholder="সর্বমোট টাকা"
                       class="px-2 py-3 bg-white text-black w-full text-sm border-b-2 focus:border-[#007bff] outline-none" />
            </div>

            <div class="relative flex items-center sm:col-span-2">
                <input asp-for="Deposit" id="depositAmount" type="number" placeholder="পরিশোধক্রিত টাকা"
                       class="px-2 py-3 bg-white text-black w-full text-sm border-b-2 focus:border-[#007bff] outline-none" />
            </div>

            <div class="relative flex items-center sm:col-span-2">
                <input asp-for="DuePrice" readonly id="dueAmount" type="number" placeholder="বাকি টাকা"
                       class="px-2 py-3 bg-white text-black w-full text-sm border-b-2 focus:border-[#007bff] outline-none" />
            </div>
        </div>

        <button type="button"
                class="mt-10 px-6 py-2.5 w-full text-sm bg-[#007bff] text-white hover:bg-[#006bff] rounded-sm">
            Submit
        </button>
    </form>
</div>



<script>
    const products = {
        rice: { buyPrice: 50, stock: 100 },
        wheat: { buyPrice: 40, stock: 80 },
        potato: { buyPrice: 20, stock: 200 },
        pointedGourd: { buyPrice: 30, stock: 150 }
    };

    const customernameProduct = {
        sifat: { customerPhoneNo: 01763669824, customerAddress: "Dhaka", shabek: 1000 },
        robiul: { customerPhoneNo: 015664654, customerAddress: "Dhaka", shabek: 1000 },
        sabbir: { customerPhoneNo: 01545454, customerAddress: "Dhaka", shabek: 1000 },
        shabek: { customerPhoneNo: 01465465465, customerAddress: "Dhaka", shabek: 1000 },
    };

    let grandTotal = 0;

    // পণ্য যোগ করার পরে সর্বমোট টাকার হিসাব আপডেট
    function updateGrandTotal() {
        const totalPriceElements = document.querySelectorAll("#productTable tbody tr td:nth-child(5)");
        grandTotal = 0;
        totalPriceElements.forEach(element => {
            grandTotal += parseFloat(element.innerText);
        });
        document.getElementById("totalTotalPrice").value = grandTotal.toFixed(2);
        updateDueAmount(); // Due হিসাব করার জন্য কল
        updateShorboMotTaka(); // সর্বমোট টাকার হিসাব করার জন্য কল
    }

    // সর্বমোট টাকার হিসাব
    function updateShorboMotTaka() {
        const shabek = parseFloat(document.getElementById("shabek").value) || 0;
        const totalTotalPrice = parseFloat(document.getElementById("totalTotalPrice").value) || 0;
        const shorboMotTaka = shabek + totalTotalPrice;

        document.getElementById("shorboMotTaka").value = shorboMotTaka.toFixed(2);
    }

    // বাকি টাকার হিসাব
    function updateDueAmount() {
        const deposit = parseFloat(document.getElementById("depositAmount").value) || 0;
        const totalTotalPrice = parseFloat(document.getElementById("totalTotalPrice").value) || 0;
        const shabek = parseFloat(document.getElementById("shabek").value) || 0;

        // মোট টাকা হিসাব করুন
        let totalPayable = shabek + totalTotalPrice; // সাবেক টাকা + মোট টাকা
        let due = totalPayable - deposit; // বাকি টাকা

        if (due < 0) {
            due = 0; // যদি বাকি টাকা ঋণাত্মক হয় তবে সেটি 0 করুন
        }

        document.getElementById("dueAmount").value = due.toFixed(2);

        // সাবেক টাকার হিসাব আপডেট করা
        let shabekAmount = parseFloat(document.getElementById("shabek").value) || 0;
        if (deposit > totalTotalPrice) {
            const excessPayment = deposit - totalTotalPrice; // অতিরিক্ত টাকা
            
        }
        document.getElementById("shabek").value = shabekAmount.toFixed(2);
        updateShorboMotTaka(); // সর্বমোট টাকার হিসাব আপডেট করুন
    }

    // Deposit এর ইনপুটের পরিবর্তন ট্র্যাক করার জন্য
    document.getElementById("depositAmount").addEventListener("input", function () {
        // ঋণাত্মক মান প্রবেশ ঠেকানো
        const depositInput = parseFloat(this.value) || 0;
        if (depositInput < 0) {
            this.value = 0; // ঋণাত্মক মান হলে সেটি 0 এ সেট করুন
        }
        updateDueAmount();
    });

    // পণ্যের দাম ও স্টক প্রদর্শনের জন্য
    document.getElementById("productName").addEventListener("change", function () {
        const selectedProduct = this.value;
        if (products[selectedProduct]) {
            document.getElementById("buyPrice").value = products[selectedProduct].buyPrice;
            document.getElementById("stock").value = products[selectedProduct].stock;
        } else {
            document.getElementById("buyPrice").value = '';
            document.getElementById("stock").value = 0;
        }
        calculateTotal();
    });

    // কাস্টমার তথ্য আপডেট
    document.getElementById("customerName").addEventListener("change", function () {
        const selectedProduct = this.value;
        if (customernameProduct[selectedProduct]) {
            document.getElementById("customerPhoneNo").value = customernameProduct[selectedProduct].customerPhoneNo;
            document.getElementById("customerAddress").value = customernameProduct[selectedProduct].customerAddress;
            document.getElementById("shabek").value = customernameProduct[selectedProduct].shabek;
        } else {
            document.getElementById("customerPhoneNo").value = '';
            document.getElementById("customerAddress").value = '';
            document.getElementById("shabek").value = 0;
        }
        updateShorboMotTaka();
    });

    // ইনপুটে ঋণাত্মক সংখ্যা ঠেকানো
    const nonNegativeInputs = document.querySelectorAll("#quantity, #sellPrice");

    nonNegativeInputs.forEach(input => {
        input.addEventListener("input", function () {
            // ইনপুটের মান পজিটিভ করতে হবে
            const value = parseFloat(this.value);
            if (value < 0) {
                this.value = 0; // ঋণাত্মক মান হলে সেটি 0 এ সেট করুন
            }
            calculateTotal(); // Total হিসাব করার জন্য
        });
    });

    function calculateTotal() {
        const quantity = document.getElementById("quantity").value;
        const sellPrice = document.getElementById("sellPrice").value;
        if (quantity && sellPrice) {
            document.getElementById("totalPrice").value = quantity * sellPrice;
        } else {
            document.getElementById("totalPrice").value = '';
        }
    }

    // পণ্য যুক্ত করা এবং অ্যাকশন আইকন গুলি যোগ করা
    document.getElementById("addProductBtn").addEventListener("click", function () {
        const productName = document.getElementById("productName").value;
        const buyPrice = document.getElementById("buyPrice").value;
        const sellPrice = document.getElementById("sellPrice").value;
        const quantity = document.getElementById("quantity").value;
        const totalPrice = document.getElementById("totalPrice").value;

        if (productName && buyPrice && sellPrice && quantity && totalPrice) {
            const table = document.getElementById("productTable").querySelector("tbody");
            const newRow = document.createElement("tr");

            newRow.innerHTML = `
                    <td class="px-4 py-2">${document.querySelector(`#productName option[value="${productName}"]`).innerText}</td>
                    <td class="px-4 py-2">${buyPrice}</td>
                    <td class="px-4 py-2">${sellPrice}</td>
                    <td class="px-4 py-2">${quantity}</td>
                    <td class="px-4 py-2">${totalPrice}</td>
                    <td class="px-4 py-2">
                        <button class="editBtn text-blue-600 hover:underline">আপডেট</button> |
                        <button class="deleteBtn text-red-600 hover:underline">ডিলিট</button>
                    </td>
                `;

            table.appendChild(newRow);

            // Update the grand total
            updateGrandTotal();

            // ফর্ম ক্লিয়ার করা
            document.getElementById("productName").value = '';
            document.getElementById("buyPrice").value = '';
            document.getElementById("stock").value = 0;
            document.getElementById("quantity").value = '';
            document.getElementById("sellPrice").value = '';
            document.getElementById("totalPrice").value = '';

            // ডিলিট ফাংশন
            newRow.querySelector(".deleteBtn").addEventListener("click", function () {
                table.removeChild(newRow);
                updateGrandTotal(); // পণ্য ডিলিট করার পর মোট টাকা আপডেট করা
            });

            // আপডেট ফাংশন
            newRow.querySelector(".editBtn").addEventListener("click", function () {
                document.getElementById("productName").value = productName;
                document.getElementById("buyPrice").value = buyPrice;
                document.getElementById("sellPrice").value = sellPrice;
                document.getElementById("quantity").value = quantity;
                document.getElementById("totalPrice").value = totalPrice;

                table.removeChild(newRow);
                updateGrandTotal(); // পণ্য আপডেট করার পর মোট টাকা আপডেট করা
            });
        } else {
            alert("দয়া করে সমস্ত তথ্য সঠিকভাবে পূরণ করুন!");
        }
    });
</script>


